{"version":3,"sources":["../src/router.js"],"names":["$routes","$all_routes","$methods","requireHandler","path","obj","require","default","makeRoute","methods","uri","handler","options","callable","method","indexOf","Error","split","object","Array","isArray","addRoute","route","push","Router","constructor","verb","get","post","put","patch","delete","only","any","group","match","request","routes","k","hasOwnProperty","matches","dispatch","ctx","next","throw","params","resolve","handle"],"mappings":"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","file":"router.js","sourcesContent":["\"use strict\";\n\nimport url from \"./url\";\nimport Route from \"./route\";\n\nvar $routes = {},\n    $all_routes = [],\n    $methods = [\n        \"GET\",\n        \"HEAD\",\n        \"POST\",\n        \"PUT\",\n        \"PATCH\",\n        \"DELETE\"\n    ];\n\nfunction requireHandler(path) {\n    var obj = require(path);\n\n    if ((typeof obj[\"__esModule\"] !== \"undefined\") && (obj[\"__esModule\"] === true)) {\n        return obj.default;\n    }\n\n    if (typeof obj[\"default\"] !== \"undefined\") {\n        return obj.default;\n    }\n\n    return obj;\n}\n\nfunction makeRoute(methods, uri, handler, options) {\n    var callable;\n\n    // Validating route methods\n    for (let method of methods) {\n        if ($methods.indexOf(method) < 0) {\n            throw new Error(`Invalid route method [${method}].`);\n        }\n    }\n\n    // Resolve route callback\n    if (typeof handler === \"string\") {\n        callable = async function () {\n            var [path, method] = handler.split(\"@\"),\n                object = new (requireHandler(path));\n\n            return await object[method];\n        };\n    } else if (typeof handler === \"object\" && Array.isArray(handler)) {\n        callable = async function () {\n            var [path, method] = handler,\n                object = new (requireHandler(path));\n\n            return await object[method];\n        };\n    } else if (typeof handler === \"object\") {\n        // TODO: ?\n    } else if (typeof handler === \"function\") {\n        callable = async function () {\n            return await handler;\n        };\n    } else {\n        throw new Error(\"Invalid route callback.\");\n    }\n\n    return new Route(methods, uri, callable, options);\n}\n\nfunction addRoute(methods, uri, handler, options) {\n    var route = makeRoute(methods, uri, handler, options);\n\n    for (var method of methods) {\n        if (typeof $routes[method] !== \"undefined\") {\n            $routes[method][uri] = route;\n        }\n    }\n\n    $all_routes.push(route);\n\n    return route;\n}\n\nclass Router {\n    constructor() {\n        for (var verb of $methods) {\n            $routes[verb] = {};\n        }\n    }\n\n    get(uri, handler, options = {}) {\n        return addRoute([\"GET\", \"HEAD\"], uri, handler, options);\n    }\n\n    post(uri, handler, options = {}) {\n        return addRoute([\"POST\"], uri, handler, options);\n    }\n\n    put(uri, handler, options = {}) {\n        return addRoute([\"PUT\"], uri, handler, options);\n    }\n\n    patch(uri, handler, options = {}) {\n        return addRoute([\"PATCH\"], uri, handler, options);\n    }\n\n    delete(uri, handler, options = {}) {\n        return addRoute([\"DELETE\"], uri, handler, options);\n    }\n\n    only(methods, uri, handler, options = {}) {\n        return addRoute(methods, uri, handler, options);\n    }\n\n    any(uri, handler, options = {}) {\n        return addRoute($methods, uri, handler, options);\n    }\n\n    // TODO:\n    group() {\n\n    }\n\n    match(request) {\n        var routes = typeof $routes[request.method] !== \"undefined\" ? $routes[request.method] : [];\n\n        for (let k in routes) {\n            if (routes.hasOwnProperty(k)) {\n                var route = routes[k];\n\n                if (route.matches(request) === true) {\n                    return route;\n                }\n            }\n        }\n\n        return null;\n    }\n\n    async dispatch(ctx, next) {\n        var route = this.match(ctx.request);\n\n        if (route === null) {\n            ctx.throw(404);\n        }\n\n        ctx.request.route = route;\n        ctx.request.params = route.resolve(ctx.request);\n\n        return await route.handle(ctx, next);\n    }\n\n    get routes() {\n        return $all_routes;\n    }\n}\n\nexport default Router;"]}